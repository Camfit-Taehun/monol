# UC-01: 세션 → 태스크 자동 변환

## 가치(Why)
세션 종료 시 자동으로 TODO/결정/리스크를 추출해 Workbase 태스크를 생성하여 정리 비용을 줄입니다.

## 범위(What)
- 트리거: Claude Code `SessionEnd` 훅(또는 `PreCompact`)
- 산출: Workbase 태스크(최소 1개) + 세션 요약 저장(events)
- 중복 방지: 같은 세션에 대해 2회 실행되어도 태스크 중복 생성 금지

## 선행 조건/의존(Task)
- TASK-120 통합 monol 스캐폴딩
- TASK-200 events 스키마
- TASK-302 workbase tool/API

## 구현 설계/개발 플랜(How)
### 1) Hook 엔트리
- 위치: `monol/.claude-plugin/hooks/session-end.sh` (또는 node runner)
- 동작:
  1. 현재 세션 ID/로그 경로를 환경변수/컨텍스트에서 획득
  2. datastore에서 해당 세션의 events를 조회
  3. extractor로 TODO/결정/리스크 항목 추출
  4. `workbase.createTask`(내부 API 또는 MCP tool) 호출
  5. 생성 결과(태스크 id)를 events에 기록(`task.created.from_session`)

### 2) Extractor 구현
- 위치: `monol/src/core/session/extractors.ts`
- 규칙:
  - TODO: `TODO`, `해야`, `다음`, `FIXME`
  - Decision: `결정`, `decided`, `ADR`
  - Risk: `리스크`, `주의`, `breaking`

### 3) Dedupe 키
- `sessionId + normalizedTitleHash`

### 4) 설정
- env:
  - `MONOL_AUTOCREATE_TASKS=true|false`
  - `MONOL_TASK_MAX_PER_SESSION=10`

## 수정/생성 파일(초안)
- `monol/.claude-plugin/hooks/session-end.sh`
- `monol/src/core/session/extractors.ts`
- `monol/src/core/workbase/adapter.ts`
- `monol/src/core/datastore/client.ts`
- `monol/tests/extractors.test.ts`

## 테스트 시나리오(재현 절차)
### 자동(단위)
- extractor 입력 텍스트 → TODO/Decision/Risk 추출 결과 스냅샷 테스트

### 통합(로컬)
1) 샘플 세션 events를 datastore에 넣는다
2) `monol run hook session-end --session <id>` 실행
3) 기대:
   - Workbase에 태스크 생성
   - events에 `task.created.from_session` 기록

### 엣지
- 세션에 TODO가 0개면 태스크 생성 0개 + “없음” 로그
- 동일 세션 2회 실행해도 중복 태스크 없음

## 완료 기준(DoD)
- [ ] 기능이 end-to-end로 재현된다
- [ ] 실패 케이스(권한/빈 데이터/네트워크 오류) 처리
- [ ] 자동 테스트 최소 1개 추가(단위/통합/스크립트)
