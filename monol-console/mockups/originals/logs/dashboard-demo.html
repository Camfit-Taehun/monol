<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Session Dashboard - monol-logs</title>
  <!-- Monol Design System -->
  <link rel="stylesheet" href="../../../../monol-design/monol-design.min.css">
  <style>
    :root {
      /* Monol Design System Colors */
      --bg-primary: var(--monol-bg-base, #0a0a0a);
      --bg-secondary: var(--monol-bg-elevated, #171717);
      --bg-tertiary: var(--monol-bg-surface, #1a1a1a);
      --text-primary: var(--monol-fg-base, #fafafa);
      --text-secondary: var(--monol-fg-muted, #a3a3a3);
      --text-muted: var(--monol-fg-subtle, #737373);
      --border-color: var(--monol-border-base, #262626);
      --accent-blue: var(--monol-info, #3b82f6);
      --accent-green: var(--monol-success, #22c55e);
      --accent-purple: #a855f7;
      --accent-orange: var(--monol-primary, #f97316);
      --accent-red: var(--monol-error, #ef4444);
      --accent-cyan: #06b6d4;
    }

    .light-theme {
      --bg-primary: #ffffff;
      --bg-secondary: #f6f8fa;
      --bg-tertiary: #eaeef2;
      --text-primary: #24292f;
      --text-secondary: #57606a;
      --text-muted: #8c959f;
      --border-color: #d0d7de;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
    }

    .container { max-width: 1400px; margin: 0 auto; padding: 24px; }

    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-color);
    }

    .logo { display: flex; align-items: center; gap: 12px; }
    .logo h1 { font-size: 20px; font-weight: 600; }
    .logo span { color: var(--text-secondary); font-size: 14px; }
    .header-actions { display: flex; gap: 8px; }

    .btn {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.15s;
    }
    .btn:hover { background: var(--bg-tertiary); }
    .btn-primary {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
      color: white;
    }
    .btn-primary:hover { opacity: 0.9; }

    /* Filters */
    .filters { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
    .filter-group { display: flex; align-items: center; gap: 8px; }
    .filter-group label { font-size: 14px; color: var(--text-secondary); }
    .filter-group select, .filter-group input {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 14px;
    }
    .filter-group input { width: 140px; }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }
    .stat-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      text-align: center;
    }
    .stat-value { font-size: 32px; font-weight: 600; color: var(--accent-blue); }
    .stat-label { font-size: 14px; color: var(--text-secondary); margin-top: 4px; }

    /* Timeline */
    .timeline-section { margin-bottom: 32px; }
    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .timeline-container {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      overflow-x: auto;
    }
    .timeline { min-width: 600px; }
    .timeline-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }
    .timeline-row { display: flex; align-items: center; margin-bottom: 8px; }
    .timeline-author { width: 100px; font-size: 14px; color: var(--text-secondary); flex-shrink: 0; }
    .timeline-bars {
      flex: 1;
      height: 24px;
      position: relative;
      background: var(--bg-tertiary);
      border-radius: 4px;
    }
    .timeline-bar {
      position: absolute;
      height: 20px;
      top: 2px;
      border-radius: 3px;
      cursor: pointer;
      transition: opacity 0.15s;
    }
    .timeline-bar:hover { opacity: 0.8; }
    .timeline-bar[data-color="blue"] { background: var(--accent-blue); }
    .timeline-bar[data-color="green"] { background: var(--accent-green); }
    .timeline-bar[data-color="purple"] { background: var(--accent-purple); }
    .timeline-bar[data-color="orange"] { background: var(--accent-orange); }
    .timeline-bar[data-color="red"] { background: var(--accent-red); }
    .timeline-bar[data-color="cyan"] { background: var(--accent-cyan); }

    /* Session Cards */
    .sessions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 16px;
    }
    .session-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      transition: border-color 0.15s;
    }
    .session-card:hover { border-color: var(--accent-blue); }
    .session-card.expanded { grid-column: 1 / -1; }
    .session-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    .session-topic { font-size: 16px; font-weight: 600; word-break: break-word; }
    .session-id { font-size: 12px; color: var(--text-muted); font-family: monospace; }
    .session-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 12px;
      font-size: 14px;
      color: var(--text-secondary);
    }
    .session-meta-item { display: flex; align-items: center; gap: 4px; }
    .author-badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    .author-badge[data-color="blue"] { background: rgba(88, 166, 255, 0.2); color: var(--accent-blue); }
    .author-badge[data-color="green"] { background: rgba(63, 185, 80, 0.2); color: var(--accent-green); }
    .author-badge[data-color="purple"] { background: rgba(163, 113, 247, 0.2); color: var(--accent-purple); }
    .author-badge[data-color="orange"] { background: rgba(210, 153, 34, 0.2); color: var(--accent-orange); }
    .author-badge[data-color="red"] { background: rgba(248, 81, 73, 0.2); color: var(--accent-red); }
    .author-badge[data-color="cyan"] { background: rgba(57, 197, 207, 0.2); color: var(--accent-cyan); }

    .session-actions { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
    .session-actions .btn { text-align: center; padding: 8px 4px; font-size: 13px; }

    /* Preview Section */
    .session-preview {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border-color);
      display: none;
    }
    .session-preview.show { display: block; }
    .preview-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .preview-tab {
      padding: 6px 16px;
      border-radius: 6px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      border: none;
      cursor: pointer;
      font-size: 13px;
    }
    .preview-tab.active {
      background: var(--accent-blue);
      color: white;
    }
    .preview-content {
      background: var(--bg-tertiary);
      border-radius: 8px;
      padding: 16px;
      max-height: 400px;
      overflow-y: auto;
      font-size: 14px;
      white-space: pre-wrap;
      font-family: 'SF Mono', Monaco, 'Courier New', monospace;
    }
    .preview-content h2 { font-size: 16px; margin: 16px 0 8px; color: var(--accent-blue); }
    .preview-content h2:first-child { margin-top: 0; }
    .preview-content ul { margin-left: 20px; }
    .preview-content .user-msg { color: var(--accent-green); }
    .preview-content .assistant-msg { color: var(--accent-purple); }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
    }
    .modal-overlay.show { opacity: 1; visibility: visible; }
    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .modal-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-header h3 { font-size: 18px; }
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-secondary);
      cursor: pointer;
    }
    .modal-body {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }
    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    /* Resume Modal */
    .resume-instructions {
      background: var(--bg-tertiary);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .resume-instructions code {
      display: block;
      background: var(--bg-primary);
      padding: 12px;
      border-radius: 6px;
      margin-top: 8px;
      font-family: 'SF Mono', Monaco, monospace;
      color: var(--accent-green);
    }
    .resume-instructions p {
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 8px;
    }

    /* Tooltip */
    .tooltip {
      position: fixed;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 12px;
      pointer-events: none;
      z-index: 1000;
      max-width: 300px;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--accent-green);
      color: white;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 14px;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s;
      z-index: 1001;
    }
    .toast.show { opacity: 1; transform: translateY(0); }

    /* Empty State */
    .empty-state { text-align: center; padding: 48px; color: var(--text-secondary); }
    .empty-state h3 { margin-bottom: 8px; }

    /* Responsive */
    @media (max-width: 768px) {
      .container { padding: 16px; }
      header { flex-direction: column; gap: 16px; align-items: flex-start; }
      .filters { flex-direction: column; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .sessions-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <h1>Session Dashboard</h1>
        <span>monol-logs</span>
      </div>
      <div class="header-actions">
        <button class="btn" onclick="toggleTheme()">Theme</button>
        <button class="btn" onclick="exportData()">Export</button>
      </div>
    </header>

    <div class="filters">
      <div class="filter-group">
        <label>Author:</label>
        <select id="filterAuthor" onchange="applyFilters()">
          <option value="">All</option>
        </select>
      </div>
      <div class="filter-group">
        <label>From:</label>
        <input type="date" id="filterDateFrom" onchange="applyFilters()">
      </div>
      <div class="filter-group">
        <label>To:</label>
        <input type="date" id="filterDateTo" onchange="applyFilters()">
      </div>
      <div class="filter-group">
        <label>Topic:</label>
        <input type="text" id="filterTopic" placeholder="Search..." oninput="applyFilters()">
      </div>
    </div>

    <div class="stats-grid" id="statsGrid"></div>

    <section class="timeline-section">
      <h2 class="section-title">Timeline</h2>
      <div class="timeline-container">
        <div class="timeline" id="timeline"></div>
      </div>
    </section>

    <section>
      <h2 class="section-title">Sessions <span id="sessionCount"></span></h2>
      <div class="sessions-grid" id="sessionsGrid"></div>
    </section>
  </div>

  <div class="tooltip" id="tooltip" style="display: none;"></div>
  <div class="toast" id="toast"></div>

  <!-- Resume Modal -->
  <div class="modal-overlay" id="resumeModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Resume Session</h3>
        <button class="modal-close" onclick="closeModal('resumeModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="resume-instructions">
          <p>í„°ë¯¸ë„ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”:</p>
          <code id="resumeCommand">claude --resume session-id</code>
        </div>
        <p style="color: var(--text-secondary); font-size: 14px;">
          ë˜ëŠ” Claude Code ë‚´ì—ì„œ <code style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px;">/session resume &lt;id&gt;</code> ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal('resumeModal')">Close</button>
        <button class="btn btn-primary" onclick="copyResumeCommand()">Copy Command</button>
      </div>
    </div>
  </div>

  <script>
    // Session data will be injected here
    const SESSION_DATA = [{"sessionId": "a1b2c3d4-1111-2222-3333-444444444444", "source": "demo", "topic": "login-feature", "createdAt": "2026-01-19T09:00:00Z", "savedAt": "2026-01-19T12:30:00Z", "savedBy": "alice", "messageCount": 142, "size": 450000}, {"sessionId": "b2c3d4e5-2222-3333-4444-555555555555", "source": "demo", "topic": "api-refactor", "createdAt": "2026-01-19T10:15:00Z", "savedAt": "2026-01-19T14:45:00Z", "savedBy": "bob", "messageCount": 89, "size": 280000}, {"sessionId": "c3d4e5f6-3333-4444-5555-666666666666", "source": "demo", "topic": "bug-fix-checkout", "createdAt": "2026-01-19T14:00:00Z", "savedAt": "2026-01-19T15:30:00Z", "savedBy": "carol", "messageCount": 35, "size": 95000}, {"sessionId": "d4e5f6g7-4444-5555-6666-777777777777", "source": "demo", "topic": "payment-integration", "createdAt": "2026-01-19T13:00:00Z", "savedAt": "2026-01-19T18:00:00Z", "savedBy": "alice", "messageCount": 256, "size": 820000}, {"sessionId": "e5f6g7h8-5555-6666-7777-888888888888", "source": "demo", "topic": "database-migration", "createdAt": "2026-01-18T09:00:00Z", "savedAt": "2026-01-18T17:00:00Z", "savedBy": "bob", "messageCount": 312, "size": 980000}, {"sessionId": "f6g7h8i9-6666-7777-8888-999999999999", "source": "demo", "topic": "ui-redesign", "createdAt": "2026-01-18T10:30:00Z", "savedAt": "2026-01-18T14:00:00Z", "savedBy": "alice", "messageCount": 78, "size": 210000}];

    // File contents will be injected here (optional)
    const FILE_CONTENTS = /* FILE_CONTENTS_PLACEHOLDER */{};

    const COLORS = ['blue', 'green', 'purple', 'orange', 'red', 'cyan'];
    const authorColors = {};
    let currentResumeId = '';

    function getAuthorColor(author) {
      if (!authorColors[author]) {
        const idx = Object.keys(authorColors).length % COLORS.length;
        authorColors[author] = COLORS[idx];
      }
      return authorColors[author];
    }

    function parseDate(str) { return new Date(str); }

    function formatDuration(ms) {
      const hours = Math.floor(ms / (1000 * 60 * 60));
      const mins = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
      if (hours > 0) return `${hours}h ${mins}m`;
      return `${mins}m`;
    }

    function formatDate(date) {
      return date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
    }

    function getFilteredSessions() {
      const authorFilter = document.getElementById('filterAuthor').value;
      const dateFrom = document.getElementById('filterDateFrom').value;
      const dateTo = document.getElementById('filterDateTo').value;
      const topicFilter = document.getElementById('filterTopic').value.toLowerCase();

      return SESSION_DATA.filter(s => {
        if (authorFilter && s.savedBy !== authorFilter) return false;
        if (dateFrom && new Date(s.createdAt) < new Date(dateFrom)) return false;
        if (dateTo && new Date(s.createdAt) > new Date(dateTo + 'T23:59:59')) return false;
        if (topicFilter && !s.topic.toLowerCase().includes(topicFilter)) return false;
        return true;
      });
    }

    function renderStats(sessions) {
      const totalMsgs = sessions.reduce((sum, s) => sum + s.messageCount, 0);
      const authors = new Set(sessions.map(s => s.savedBy));
      const totalDuration = sessions.reduce((sum, s) => {
        return sum + (parseDate(s.savedAt) - parseDate(s.createdAt));
      }, 0);

      document.getElementById('statsGrid').innerHTML = `
        <div class="stat-card">
          <div class="stat-value">${sessions.length}</div>
          <div class="stat-label">Sessions</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${authors.size}</div>
          <div class="stat-label">Authors</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${totalMsgs.toLocaleString()}</div>
          <div class="stat-label">Messages</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${formatDuration(totalDuration)}</div>
          <div class="stat-label">Total Time</div>
        </div>
      `;
    }

    function renderTimeline(sessions) {
      if (sessions.length === 0) {
        document.getElementById('timeline').innerHTML = '<div class="empty-state">No sessions to display</div>';
        return;
      }

      const authors = [...new Set(sessions.map(s => s.savedBy))];
      const minDate = Math.min(...sessions.map(s => parseDate(s.createdAt).getTime()));
      const maxDate = Math.max(...sessions.map(s => parseDate(s.savedAt).getTime()));
      const range = maxDate - minDate || 1;

      const dayCount = Math.ceil(range / (24 * 60 * 60 * 1000)) || 1;
      const labelCount = Math.min(dayCount, 7);
      const labelStep = range / labelCount;

      let headerHtml = '<div class="timeline-header">';
      for (let i = 0; i <= labelCount; i++) {
        headerHtml += `<span>${formatDate(new Date(minDate + i * labelStep))}</span>`;
      }
      headerHtml += '</div>';

      let rowsHtml = '';
      authors.forEach(author => {
        const authorSessions = sessions.filter(s => s.savedBy === author);
        const color = getAuthorColor(author);

        let barsHtml = '';
        authorSessions.forEach(s => {
          const start = parseDate(s.createdAt).getTime();
          const end = parseDate(s.savedAt).getTime();
          const left = ((start - minDate) / range) * 100;
          const width = Math.max(((end - start) / range) * 100, 1);

          barsHtml += `<div class="timeline-bar" data-color="${color}"
            style="left: ${left}%; width: ${width}%"
            data-session='${JSON.stringify(s).replace(/'/g, "&#39;")}'
            onmouseenter="showTooltip(event, this)"
            onmouseleave="hideTooltip()"
            onclick="scrollToSession('${s.sessionId}')"></div>`;
        });

        rowsHtml += `
          <div class="timeline-row">
            <div class="timeline-author">${escapeHtml(author)}</div>
            <div class="timeline-bars">${barsHtml}</div>
          </div>
        `;
      });

      document.getElementById('timeline').innerHTML = headerHtml + rowsHtml;
    }

    function renderSessions(sessions) {
      document.getElementById('sessionCount').textContent = `(${sessions.length})`;

      if (sessions.length === 0) {
        document.getElementById('sessionsGrid').innerHTML = `
          <div class="empty-state">
            <h3>No sessions found</h3>
            <p>Try adjusting your filters</p>
          </div>
        `;
        return;
      }

      const sorted = [...sessions].sort((a, b) => parseDate(b.createdAt) - parseDate(a.createdAt));

      document.getElementById('sessionsGrid').innerHTML = sorted.map(s => {
        const created = parseDate(s.createdAt);
        const saved = parseDate(s.savedAt);
        const duration = formatDuration(saved - created);
        const color = getAuthorColor(s.savedBy);
        const shortId = s.sessionId.substring(0, 8);
        const hasContent = FILE_CONTENTS[s.sessionId];

        return `
          <div class="session-card" id="session-${s.sessionId}" data-session-id="${s.sessionId}">
            <div class="session-header">
              <div>
                <div class="session-topic">${escapeHtml(s.topic)}</div>
                <div class="session-id">${shortId}</div>
              </div>
              <span class="author-badge" data-color="${color}">${escapeHtml(s.savedBy)}</span>
            </div>
            <div class="session-meta">
              <span class="session-meta-item">${created.toLocaleDateString('ko-KR')}</span>
              <span class="session-meta-item">${created.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}</span>
              <span class="session-meta-item">${duration}</span>
              <span class="session-meta-item">${s.messageCount} msgs</span>
            </div>
            <div class="session-actions">
              <button class="btn" onclick="togglePreview('${s.sessionId}', 'summary')">Summary</button>
              <button class="btn" onclick="togglePreview('${s.sessionId}', 'conversation')">Conversation</button>
              <button class="btn btn-primary" onclick="showResumeModal('${s.sessionId}')">Resume</button>
            </div>
            <div class="session-preview" id="preview-${s.sessionId}">
              <div class="preview-tabs">
                <button class="preview-tab active" onclick="switchTab('${s.sessionId}', 'summary')">Summary</button>
                <button class="preview-tab" onclick="switchTab('${s.sessionId}', 'conversation')">Conversation</button>
              </div>
              <div class="preview-content" id="preview-content-${s.sessionId}">
                Loading...
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function togglePreview(sessionId, type) {
      const preview = document.getElementById(`preview-${sessionId}`);
      const card = document.getElementById(`session-${sessionId}`);
      const isShown = preview.classList.contains('show');

      // Close all other previews
      document.querySelectorAll('.session-preview.show').forEach(p => {
        p.classList.remove('show');
        p.closest('.session-card').classList.remove('expanded');
      });

      if (!isShown) {
        preview.classList.add('show');
        card.classList.add('expanded');
        loadPreviewContent(sessionId, type);

        // Set active tab
        const tabs = preview.querySelectorAll('.preview-tab');
        tabs.forEach(t => t.classList.remove('active'));
        tabs[type === 'summary' ? 0 : 1].classList.add('active');
      }
    }

    function switchTab(sessionId, type) {
      const preview = document.getElementById(`preview-${sessionId}`);
      const tabs = preview.querySelectorAll('.preview-tab');
      tabs.forEach(t => t.classList.remove('active'));
      tabs[type === 'summary' ? 0 : 1].classList.add('active');
      loadPreviewContent(sessionId, type);
    }

    function loadPreviewContent(sessionId, type) {
      const contentEl = document.getElementById(`preview-content-${sessionId}`);
      const session = SESSION_DATA.find(s => s.sessionId === sessionId);

      if (FILE_CONTENTS[sessionId] && FILE_CONTENTS[sessionId][type]) {
        contentEl.innerHTML = formatPreviewContent(FILE_CONTENTS[sessionId][type], type);
      } else {
        // Generate placeholder content
        if (type === 'summary') {
          contentEl.innerHTML = generateMockSummary(session);
        } else {
          contentEl.innerHTML = generateMockConversation(session);
        }
      }
    }

    function generateMockSummary(session) {
      return `<h2>Session Summary</h2>
<strong>Session:</strong> ${escapeHtml(session.topic)} (${session.sessionId.substring(0, 8)})
<strong>Date:</strong> ${new Date(session.createdAt).toLocaleDateString('ko-KR')}
<strong>Author:</strong> ${escapeHtml(session.savedBy)}
<strong>Messages:</strong> ${session.messageCount}

<h2>ì£¼ìš” ì‘ì—…</h2>
<ul>
<li>ì„¸ì…˜ ë‚´ìš© ê¸°ë°˜ ì‘ì—… ìš”ì•½</li>
<li>êµ¬í˜„ëœ ê¸°ëŠ¥ ëª©ë¡</li>
<li>í•´ê²°ëœ ì´ìŠˆ</li>
</ul>

<h2>ë‹¤ìŒ í•  ì¼</h2>
<ul>
<li>[ ] í›„ì† ì‘ì—… í•­ëª©</li>
<li>[ ] í…ŒìŠ¤íŠ¸ ì¶”ê°€</li>
</ul>

<em style="color: var(--text-muted);">ì‹¤ì œ ìš”ì•½ì€ .summary.md íŒŒì¼ì—ì„œ ë¡œë“œë©ë‹ˆë‹¤.</em>`;
    }

    function generateMockConversation(session) {
      return `<h2>Session: ${escapeHtml(session.topic)}</h2>
Date: ${new Date(session.createdAt).toLocaleDateString('ko-KR')}
Author: ${escapeHtml(session.savedBy)}
Messages: ${session.messageCount}

---

<span class="user-msg">## ğŸ‘¤ User</span>
ì²« ë²ˆì§¸ ì‚¬ìš©ì ë©”ì‹œì§€ ì˜ˆì‹œ...

<span class="assistant-msg">## ğŸ¤– Assistant</span>
ì²« ë²ˆì§¸ ì–´ì‹œìŠ¤í„´íŠ¸ ì‘ë‹µ ì˜ˆì‹œ...

<span class="user-msg">## ğŸ‘¤ User</span>
ë‘ ë²ˆì§¸ ì‚¬ìš©ì ë©”ì‹œì§€...

<span class="assistant-msg">## ğŸ¤– Assistant</span>
ë‘ ë²ˆì§¸ ì–´ì‹œìŠ¤í„´íŠ¸ ì‘ë‹µ...

---
<em style="color: var(--text-muted);">ì „ì²´ ëŒ€í™”ëŠ” .conversation.md íŒŒì¼ì—ì„œ ë¡œë“œë©ë‹ˆë‹¤.</em>`;
    }

    function formatPreviewContent(content, type) {
      // Basic markdown-like formatting
      let html = escapeHtml(content);
      html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
      html = html.replace(/^# (.+)$/gm, '<h2 style="font-size:18px">$1</h2>');
      html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      html = html.replace(/^- \[ \] (.+)$/gm, '<li>â˜ $1</li>');
      html = html.replace(/^- \[x\] (.+)$/gm, '<li>â˜‘ $1</li>');
      html = html.replace(/^- (.+)$/gm, '<li>$1</li>');
      html = html.replace(/ğŸ‘¤ User/g, '<span class="user-msg">ğŸ‘¤ User</span>');
      html = html.replace(/ğŸ¤– Assistant/g, '<span class="assistant-msg">ğŸ¤– Assistant</span>');
      return html;
    }

    function showResumeModal(sessionId) {
      const session = SESSION_DATA.find(s => s.sessionId === sessionId);
      currentResumeId = sessionId;
      document.getElementById('resumeCommand').textContent = `claude --resume ${sessionId}`;
      document.getElementById('resumeModal').classList.add('show');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('show');
    }

    function copyResumeCommand() {
      const cmd = `claude --resume ${currentResumeId}`;
      navigator.clipboard.writeText(cmd).then(() => {
        showToast('Copied: ' + cmd);
        closeModal('resumeModal');
      });
    }

    function populateAuthorFilter() {
      const authors = [...new Set(SESSION_DATA.map(s => s.savedBy))];
      const select = document.getElementById('filterAuthor');
      authors.forEach(author => {
        const option = document.createElement('option');
        option.value = author;
        option.textContent = author;
        select.appendChild(option);
      });
    }

    function applyFilters() {
      const filtered = getFilteredSessions();
      renderStats(filtered);
      renderTimeline(filtered);
      renderSessions(filtered);
    }

    function showTooltip(event, el) {
      const s = JSON.parse(el.dataset.session.replace(/&#39;/g, "'"));
      const tooltip = document.getElementById('tooltip');
      const created = parseDate(s.createdAt);
      const duration = formatDuration(parseDate(s.savedAt) - created);

      tooltip.innerHTML = `
        <strong>${escapeHtml(s.topic)}</strong><br>
        Author: ${escapeHtml(s.savedBy)}<br>
        Date: ${created.toLocaleDateString('ko-KR')}<br>
        Duration: ${duration}<br>
        Messages: ${s.messageCount}
      `;
      tooltip.style.display = 'block';
      tooltip.style.left = event.pageX + 10 + 'px';
      tooltip.style.top = event.pageY + 10 + 'px';
    }

    function hideTooltip() {
      document.getElementById('tooltip').style.display = 'none';
    }

    function scrollToSession(id) {
      const el = document.getElementById('session-' + id);
      if (el) {
        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        el.style.borderColor = 'var(--accent-blue)';
        setTimeout(() => el.style.borderColor = '', 2000);
      }
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    function toggleTheme() {
      document.body.classList.toggle('light-theme');
    }

    function exportData() {
      const filtered = getFilteredSessions();
      const blob = new Blob([JSON.stringify(filtered, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'sessions.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    // Close modal on overlay click
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.classList.remove('show');
        }
      });
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      populateAuthorFilter();
      applyFilters();
    });
  </script>
</body>
</html>
